<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 3: Working with the U.S. Census</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CRD 150: Spring 2022</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="hw_guidelines.html">Assignment Guidelines</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs/Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lab1.html">Lab 1</a>
    </li>
    <li>
      <a href="lab2.html">Lab 2</a>
    </li>
    <li>
      <a href="lab3.html">Lab 3</a>
    </li>
    <li>
      <a href="lab4.html">Lab 4</a>
    </li>
    <li>
      <a href="lab5.html">Lab 5</a>
    </li>
    <li>
      <a href="lab6.html">Lab 6</a>
    </li>
    <li>
      <a href="lab7a.html">Lab 7a</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="eligible.html">Eligible Communities</a>
    </li>
    <li>
      <a href="tips.html">R tips</a>
    </li>
    <li>
      <a href="ndata.html">Neighborhood Data Sources</a>
    </li>
    <li>
      <a href="bigopendata.html">Big and Open Data Sources</a>
    </li>
    <li>
      <a href="policymap.html">PolicyMap </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lab 3: Working with the U.S. Census</h1>
<h3 class="subtitle"><h4 style="font-style:normal">
CRD 150 - Quantitative Methods in Community Research
</h4></h3>
<h4 class="author"><h4 style="font-style:normal">
Professor Noli Brazil
</h4></h4>
<h4 class="date"><h4 style="font-style:normal">
April 13, 2022
</h4></h4>

</div>


<style>
p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-style: normal;
}

.figure {
   margin-top: 20px;
   margin-bottom: 20px;
}

h1.title {
  font-weight: bold;
  font-family: Arial;  
}

h2.title {
  font-family: Arial;  
}

</style>
<style type="text/css">
#TOC {
  font-size: 13px;
  font-family: Arial;
}
</style>
<p><br />
</p>
<p>In this guide you will learn how to download, clean and manage United States Census data using R. You will be working with data on U.S. counties. The objectives of the guide are as follows.</p>
<ol style="list-style-type: decimal">
<li>Download Census data using their API</li>
<li>Download Census data using PolicyMap</li>
<li>Learn more data wrangling functions</li>
</ol>
<p>This lab guide follows closely and supplements the material presented in Chapters 3, 9-10, and 14 in the textbook <a href="http://r4ds.had.co.nz/index.html">R for Data Science</a> (RDS) and the class Handouts 2 and 3.</p>
<p class="comment">
<strong>Assignment 3 is due by 2:00 pm, April 20 on Canvas.</strong> See <a href="https://crd150.github.io/hw_guidelines.html">here</a> for assignment guidelines. You must submit an <code>.Rmd</code> file and its associated <code>.html</code> file. Name the files: yourLastName_firstInitial_asgn03. For example: brazil_n_asgn03.
</p>
<div style="margin-bottom:25px;">

</div>
<div id="open-up-a-r-markdown-file" class="section level2">
<h2><strong>Open up a R Markdown file</strong></h2>
<p><br />
</p>
<p>Download the <a href="https://raw.githubusercontent.com/crd150/data/master/labtemplate.Rmd">Lab template</a> into an appropriate folder on your hard drive (preferably, a folder named ‘Lab 3’), open it in R Studio, and type and run your code there. The template is also located on Canvas under Files. Change the title (“Lab 3”) and insert your name and date. Don’t change anything else inside the YAML (the stuff at the top in between the <code>---</code>). Also keep the grey chunk after the YAML. For a rundown on the use of R Markdown, see the <a href="https://crd150.github.io/hw_guidelines.html">assignment guidelines</a></p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="installing-packages" class="section level2">
<h2><strong>Installing Packages</strong></h2>
<p><br />
</p>
<p>As described in <a href="https://crd150.github.io/lab2.html#R_Packages">Lab 2</a>, many functions are part of packages that are not preinstalled into R. In Lab 2, we had to install the package <strong>tidyverse</strong>. In this lab, you’ll need to install the package <strong>tidycensus</strong>, which contains all the functions needed to download Census data using the Census API. We’ll also need to install the package <strong>VIM</strong>, which provides functions for summarizing missingness in our dataset (a concept covered in Handout 2). Run the following code to install these packages.</p>
<pre class="r"><code>install.packages(&quot;tidycensus&quot;) 
install.packages(&quot;VIM&quot;)</code></pre>
<p>Run the above code directly in your console, not in your R Markdown. You only need to install packages once. <a href="https://www.youtube.com/watch?v=1lXwT7mxmf8">Never more</a>.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="loading-packages" class="section level2">
<h2><strong>Loading Packages</strong></h2>
<p><br />
</p>
<p>Installing a package does not mean its functions are accessible during a given R session. You’ll need to load packages using the function <code>library()</code>. Unlike installing, you need to use <code>library()</code> every time you start an R session, so it should be in your R Markdown file. A good practice is to load all the packages you will be using in a given R Markdown at the top of the file. Let’s load the packages we’ll be using in this lab.</p>
<pre class="r"><code>library(tidyverse)
library(tidycensus)
library(VIM)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="downloading-census-data" class="section level2">
<h2><strong>Downloading Census Data</strong></h2>
<p><br />
</p>
<p>There are two ways to bring Census data into R: Downloading from an online source and using the Census API.</p>
<div style="margin-bottom:25px;">

</div>
<div id="downloading-from-an-online-source" class="section level3">
<h3><strong>Downloading from an online source</strong></h3>
<p><br />
</p>
<p>The first way to obtain Census data is to download them directly from the web onto your hard drive. There are several websites where you can download Census data including <a href="https://www.socialexplorer.com/">Social Explorer</a>, <a href="https://www.nhgis.org/">National Historical Geographic Information System (NHGIS)</a>, and <a href="https://data.census.gov/cedsci/?intcmp=aff_cedsci_banner">data.census.gov</a>. The site we’ll use in this lab is <a href="https://ucdavis.policymap.com/maps">PolicyMap</a>.</p>
<p>UC Davis provides full access to all PolicyMap tools for staff, students, and faculty. You can access the full site only if you are on campus or logged onto the UC Davis VPN Client. Download the PulseSecure VPN app using the directions outlined <a href="https://www.library.ucdavis.edu/service/connect-from-off-campus/">here</a>.The following sections provide step-by-step instructions for downloading data from PolicyMap and reading it into R. We will be downloading the percent of residents with a bachelor’s degree in California counties from the 2015-2019 American Community Survey.</p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>Navigate to the UC Davis <a href="https://ucdavis.policymap.com/maps">PolicyMap portal</a>. If you get a message telling you about the new PolicyMap website, just click on OK. You should see a webpage that looks like the figure below. Note the UC Davis logo on the top right. Go Aggies!</li>
</ol>
<center>
<p><img src="pmpage.png" /></p>
</center>
<ol start="2" style="list-style-type: decimal">
<li>You should see a <em>Location</em> search bar somewhere near the top of the page. Type in “California” in the search bar and <em>California (State)</em> should pop up as the first selection. Click it.</li>
</ol>
<center>
<p><img src="typecalifornia.png" /></p>
</center>
<p><br></p>
<p>You should get a map that highlights California’s boundaries.</p>
<center>
<p><img src="camap1.png" /></p>
</center>
<ol start="3" style="list-style-type: decimal">
<li>The map does not show any data. Let’s add the percent of residents with a bachelor’s degree in California counties. Click on the <em>Education</em> tab, followed by <em>Educational Attainment</em> and then <em>At least a Bachelor’s Degree</em>.</li>
</ol>
<center>
<p><img src="pbach.png" /></p>
</center>
<p>Now your map should look like the following</p>
<center>
<p><img src="pbachmap.png" /></p>
</center>
<ol start="4" style="list-style-type: decimal">
<li>Notice in the legend window you can change various aspects of the variable, including the year</li>
</ol>
<center>
<p><img src="pmyear2.png" /></p>
</center>
<p>the data type</p>
<center>
<p><img src="pmdata2.png" /></p>
</center>
<p>and the geographic level.</p>
<center>
<p><img src="pmgeo2.png" /></p>
</center>
<p>Leave the defaults (Year: 2015-2019, Variable: Percent, and Shaded by: County, 2010). <em>County, 2010</em> indicates that you want to show the data by county using 2010 county boundaries.</p>
<ol start="5" style="list-style-type: decimal">
<li><p>Let’s download these data. At the top right of the site, click on the download icon <img src="download.png" />.</p></li>
<li><p>A window should pop up. The first screen asks you what data to download - it should be “Estimated percent of people with at least a Bachelor’s degree, between 2015-2019” under Layer. Click on the <em>Next, Select Location</em> button</p></li>
</ol>
<center>
<p><img src="pmfirst2.png" /></p>
</center>
<ol start="7" style="list-style-type: decimal">
<li>The next screen asks you to select a location. It should be <em>California (State)</em> and <em>Shaded by County</em> under the header <em>Pre-Defined Location</em>. Click on <em>Next, Confirm Download</em>.</li>
</ol>
<center>
<p><img src="pmsecond2.png" /></p>
</center>
<ol start="8" style="list-style-type: decimal">
<li><p>The next screen asks you to confirm the download - just click on Download CSV <img src="dlcsv.png" /></p></li>
<li><p>After a minute or two, a screen like below (on a Mac laptop) should pop up (the file name will differ from yours).</p></li>
</ol>
<center>
<p><img src="downloadcsv2.png" /></p>
</center>
<p>Save the file into an appropriate folder, such as below (Mac laptop)</p>
<center>
<p><img src="pmfolder.png" /></p>
</center>
<ol start="10" style="list-style-type: decimal">
<li>Let’s bring the csv file into R. We covered how to read in data into R in <a href="https://crd150.github.io/lab2.html#Reading_data">Lab 2</a>. Make sure your <a href="https://crd150.github.io/lab2.html#Reading_data">working directory is pointed to the folder containing the file</a>. Then read in the file using the function <code>read_csv()</code>.</li>
</ol>
<pre class="r"><code>ca.pm &lt;- read_csv(&quot;TYPE THE FILE NAME HERE WITH CSV EXTENSION&quot;)</code></pre>
<p>If you’re having trouble downloading the file from PolicyMap, I uploaded it onto GitHub. Read it in using the following code.</p>
<pre class="r"><code>ca.pm &lt;- read_csv(&quot;https://raw.githubusercontent.com/crd150/data/master/PolicyMap%20Data%202021-01-20%201623UTC.csv&quot;)</code></pre>
<p>When you bring in a dataset, the first thing you should always do is view it just to make sure you got what you expected. You can do this directly in the console by using the function <code>glimpse()</code>, which we covered in <a href="https://crd150.github.io/lab2.html#Reading_data">Lab 2</a>.</p>
<pre class="r"><code>glimpse(ca.pm)</code></pre>
<pre><code>## Rows: 64
## Columns: 4
## $ County                                                             &lt;chr&gt; &quot;Sa…
## $ `FIPS Code`                                                        &lt;chr&gt; &quot;06…
## $ `Formatted FIPS`                                                   &lt;chr&gt; &quot;=\…
## $ `Estimated percent of people with at least a Bachelor&#39;s degree, b` &lt;dbl&gt; 20.…</code></pre>
<p><br></p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="using-the-census-api" class="section level3">
<h3><strong>Using the Census API</strong></h3>
<p><br />
</p>
<p>You can bring data directly into R using the <a href="https://www.census.gov/data/developers/guidance/api-user-guide.What_is_the_API.html">Census Application Program Interface (API)</a>. An API allows for direct requests for data in machine-readable form. That is, rather than having to navigate to a website using a browser, scroll around to find a dataset, download that dataset once you find it, save that data onto your hard drive, and then bring the data into R, you just tell R to retrieve data directly using one or two lines of code.</p>
<p>In order to directly download data from the Census API, you need a key. You can sign up for a free key <a href="http://api.census.gov/data/key_signup.html">here</a>, which you should have already done before the lab. Type your key in quotes using the <code>census_api_key()</code> command</p>
<pre class="r"><code>census_api_key(&quot;YOUR API KEY GOES HERE&quot;, install = TRUE)</code></pre>
<p>The parameter <code>install = TRUE</code> tells R to use this API key in the future so you won’t have to use <code>census_api_key()</code> again unless you update or re-download R.</p>
<p>The function for downloading American Community Survey (ACS) Census data is <code>get_acs()</code>. The command for downloading decennial Census data is <code>get_decennial()</code>. Getting variables using the Census API requires knowing the variable ID - and there are thousands of variables (and thus thousands of IDs) across the different Census files. To rapidly search for variables, use the commands <code>load_variables()</code> and <code>View()</code>. Because we’ll be using the ACS in this guide, let’s check the variables in the most recent 5-year ACS (2015-2019) using the following commands.</p>
<pre class="r"><code>v19 &lt;- load_variables(2019, &quot;acs5&quot;, cache = TRUE)
View(v19)</code></pre>
<p>A window should have popped up showing you a record layout of the 2015-19 ACS. To search for specific data, select “Filter” located at the top left of this window and use the search boxes that pop up. For example, type in “Hispanic” in the box under “Label”. You should see near the top of the list the first set of variables we’ll want to download - race/ethnicity. Another way of finding variable names is to search them using <a href="https://www.socialexplorer.com/data/metadata/">Social Explorer</a>. Click on the appropriate survey data year and then “American Community Survey Tables”, which will take you to a list of variables with their Census IDs.</p>
<p>Let’s extract race/ethnicity data and total population for California counties using the <code>get_acs()</code> command</p>
<pre class="r"><code>ca &lt;- get_acs(geography = &quot;county&quot;, 
              year = 2019,
              variables = c(tpopr = &quot;B03002_001&quot;, 
                            nhwhite = &quot;B03002_003&quot;, nhblk = &quot;B03002_004&quot;, 
                            nhasn = &quot;B03002_006&quot;, hisp = &quot;B03002_012&quot;), 
              state = &quot;CA&quot;,
              survey = &quot;acs5&quot;,
              output = &quot;wide&quot;)</code></pre>
<p>In the above code, we specified the following arguments</p>
<ul>
<li><code>geography</code>: The level of geography we want the data in; in our case, the county. Other geographic options can be found <a href="https://walkerke.github.io/tidycensus/articles/basic-usage.html#geography-in-tidycensus">here</a>.</li>
<li><code>year</code>: The end year of the data (because we want 2015-2019, we use 2019).</li>
<li><code>variables</code>: The variables we want to bring in as specified in a vector you create using the function <code>c()</code>. Note that we created variable names of our own (e.g. “nhwhite”) and we put the ACS IDs in quotes (“B03002_003”). Had we not done this, the variable names will come in as they are named in the ACS, which are not very descriptive.</li>
<li><code>state</code>: We can filter the counties to those in a specific state. Here it is “CA” for California. If we don’t specify this, we get all counties in the United States.</li>
<li><code>survey</code>: The specific Census survey were extracting data from. We want data from the 5-year American Community Survey, so we specify “acs5”. The ACS comes in 1- and 5-year varieties.<br />
</li>
<li><code>output</code>: The argument tells R to return a wide dataset as opposed to a long dataset (we covered long vs. wide data in Handout 2)</li>
</ul>
<p>Type in <code>? get_acs()</code> to see the full list of options.</p>
<p>What does our data set look like? Take a <code>glimpse()</code>.</p>
<pre class="r"><code>glimpse(ca)</code></pre>
<pre><code>## Rows: 58
## Columns: 12
## $ GEOID    &lt;chr&gt; &quot;06047&quot;, &quot;06043&quot;, &quot;06049&quot;, &quot;06013&quot;, &quot;06027&quot;, &quot;06099&quot;, &quot;06083&quot;…
## $ NAME     &lt;chr&gt; &quot;Merced County, California&quot;, &quot;Mariposa County, California&quot;, &quot;…
## $ tpoprE   &lt;dbl&gt; 271382, 17420, 8907, 1142251, 17977, 543194, 444829, 63912, 1…
## $ tpoprM   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ nhwhiteE &lt;dbl&gt; 75037, 13935, 6920, 500592, 11173, 227369, 197993, 43679, 930…
## $ nhwhiteM &lt;dbl&gt; 140, 56, 6, 537, 33, 248, 222, 15, 148, 52, 1010, 230, 208, 4…
## $ nhblkE   &lt;dbl&gt; 7812, 253, 136, 95892, 141, 15311, 8409, 472, 59, 454, 144695…
## $ nhblkM   &lt;dbl&gt; 432, 51, 26, 1240, 39, 489, 418, 40, 70, 80, 1853, 162, 335, …
## $ nhasnE   &lt;dbl&gt; 19650, 210, 99, 188237, 325, 29284, 23882, 967, 363, 1754, 23…
## $ nhasnM   &lt;dbl&gt; 528, 91, 119, 1851, 80, 860, 548, 130, 257, 172, 2024, 452, 5…
## $ hispE    &lt;dbl&gt; 161814, 1963, 1291, 292298, 4020, 251259, 201837, 15958, 3865…
## $ hispM    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
<p>The tibble contains counties with their estimates for race/ethnicity. These variables end with the letter “E”. It also contains the <a href="https://walker-data.com/tidycensus/articles/margins-of-error.html">margins of error</a> for each estimate. These variables end with the letter “M”. Although important to evaluate (we covered margins of error in Handout 3), we won’t be using the margins of error much in this class.</p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="data-wrangling" class="section level2">
<h2><strong>Data Wrangling</strong></h2>
<p><br />
</p>
<p>The ultimate goal is to merge the files <em>ca</em> and <em>ca.pm</em> together. To get there, we have to do a bit of data wrangling. We covered many data wrangling functions in <a href="https://crd150.github.io/lab2.html">Lab 2</a>. We will revisit some of those functions and introduce a few more.</p>
<div style="margin-bottom:25px;">

</div>
<div id="slice" class="section level3">
<h3><strong>Slice</strong></h3>
<p><br />
</p>
<p>Let’s first lean up <em>ca.pm</em>. The first issue with <em>ca.pm</em> is the footnotes located at the bottom of the file. In excel, the footnotes look like</p>
<p><br></p>
<center>
<p><img src="footnotes.png" /></p>
</center>
<p><br></p>
<p>When you brought the file into R, the footnotes look like</p>
<p><br></p>
<center>
<p><img src="footnotes2.png" /></p>
</center>
<p><br></p>
<p>To remove the footnotes, use the function <code>slice()</code></p>
<pre class="r"><code>ca.pm &lt;- ca.pm %&gt;%
              slice(1:58)</code></pre>
<p>The function keeps all rows from 1 to 58. Row 59 is where the footnotes begin. Make sure you look at the data (<code>View(ca.pm)</code>) to make sure the slice went as you expected.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="renaming-variables" class="section level3">
<h3><strong>Renaming variables</strong></h3>
<p><br />
</p>
<p>You will likely encounter a variable with a name that is not descriptive. Or too long. Although you should have a codebook to crosswalk variable names with descriptions, the more descriptive the names, the more efficient your analysis will be and the less likely you are going to make a mistake. Use the command <code>rename()</code> to - what else? - rename a variable!</p>
<p>First, let’s look at the <em>ca.pm</em>’s column names by using the function <code>names()</code></p>
<pre class="r"><code>names(ca.pm)</code></pre>
<pre><code>## [1] &quot;County&quot;                                                          
## [2] &quot;FIPS Code&quot;                                                       
## [3] &quot;Formatted FIPS&quot;                                                  
## [4] &quot;Estimated percent of people with at least a Bachelor&#39;s degree, b&quot;</code></pre>
<p>The variable <em>Estimated percent of people with at least a Bachelor’s degree, b</em> contains the percent of residents with a college degree or higher. Let’s shorten the name because we would not want to have to type this long name out everytime we want to refer to this variable. Make the name simple and clear. Here, we name it <em>pcol</em>.</p>
<pre class="r"><code>ca.pm &lt;- ca.pm %&gt;%
          rename(pcol = &quot;Estimated percent of people with at least a Bachelor&#39;s degree, b&quot;)

names(ca.pm)</code></pre>
<pre><code>## [1] &quot;County&quot;         &quot;FIPS Code&quot;      &quot;Formatted FIPS&quot; &quot;pcol&quot;</code></pre>
<p>Note the use of quotes around the variable name you are renaming.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="joining-tables" class="section level3">
<h3><strong>Joining tables</strong></h3>
<p><br />
</p>
<p>Our next goal is to merge together the datasets <em>ca.pm</em> and <em>ca</em>. Handout 2 (pg. 8 and Figure 6) describes the process of merging datasets. Remember from Handout 3 that the unique Census ID for a county combines the county ID with the state ID. We have this ID as the single variable <em>GEOID</em> in <em>ca</em> and <em>FIPS Code</em> in <em>ca.pm</em></p>
<center>
<p><img src="mergefips.png" /></p>
</center>
<p>To merge the two datasets together, use the function <code>left_join()</code>, which matches pairs of observations whenever their keys or IDs are equal. We match on the variables <em>GEOID</em> and <em>FIPS Code</em> and save the merged data set into a new object called <em>cacounty</em>.</p>
<pre class="r"><code>cacounty &lt;- left_join(ca, ca.pm, by = c(&quot;GEOID&quot; = &quot;FIPS Code&quot;))</code></pre>
<p>We want to merge <em>ca.pm</em> into <em>ca</em>, so that’s why the sequence is <code>ca, ca.pm</code>. The argument <em>by</em> tells R which variables to match rows on, in this case <em>GEOID</em> in <em>ca</em> and <em>FIPS Code</em> in <em>ca.pm</em>. The number of columns in <em>cacounty</em> equals the number of columns in <em>ca</em> plus the number of columns in <em>ca.pm</em> minus the ID variable you merged on. Check <em>cacounty</em> to make sure the merge went as you expected.</p>
<pre class="r"><code>glimpse(cacounty)</code></pre>
<pre><code>## Rows: 58
## Columns: 15
## $ GEOID            &lt;chr&gt; &quot;06047&quot;, &quot;06043&quot;, &quot;06049&quot;, &quot;06013&quot;, &quot;06027&quot;, &quot;06099&quot;,…
## $ NAME             &lt;chr&gt; &quot;Merced County, California&quot;, &quot;Mariposa County, Califo…
## $ tpoprE           &lt;dbl&gt; 271382, 17420, 8907, 1142251, 17977, 543194, 444829, …
## $ tpoprM           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ nhwhiteE         &lt;dbl&gt; 75037, 13935, 6920, 500592, 11173, 227369, 197993, 43…
## $ nhwhiteM         &lt;dbl&gt; 140, 56, 6, 537, 33, 248, 222, 15, 148, 52, 1010, 230…
## $ nhblkE           &lt;dbl&gt; 7812, 253, 136, 95892, 141, 15311, 8409, 472, 59, 454…
## $ nhblkM           &lt;dbl&gt; 432, 51, 26, 1240, 39, 489, 418, 40, 70, 80, 1853, 16…
## $ nhasnE           &lt;dbl&gt; 19650, 210, 99, 188237, 325, 29284, 23882, 967, 363, …
## $ nhasnM           &lt;dbl&gt; 528, 91, 119, 1851, 80, 860, 548, 130, 257, 172, 2024…
## $ hispE            &lt;dbl&gt; 161814, 1963, 1291, 292298, 4020, 251259, 201837, 159…
## $ hispM            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ County           &lt;chr&gt; &quot;Merced&quot;, &quot;Mariposa&quot;, &quot;Modoc&quot;, &quot;Contra Costa&quot;, &quot;Inyo&quot;…
## $ `Formatted FIPS` &lt;chr&gt; &quot;=\&quot;06047\&quot;&quot;, &quot;=\&quot;06043\&quot;&quot;, &quot;=\&quot;06049\&quot;&quot;, &quot;=\&quot;06013\&quot;…
## $ pcol             &lt;dbl&gt; 13.79, 24.56, 15.19, 42.35, 27.17, 17.07, 34.16, 15.6…</code></pre>
<p>Note that if you have two variables with the same name in both files, R will attach a <em>.x</em> to the variable name in <em>ca</em> and a <em>.y</em> to the variable name in <em>ca.pm</em>. For example, if you have a variable named <em>Charlotte</em> in both files, <em>cacounty</em> will contain both variables and name it <em>Charlotte.x</em> (the variable in <em>ca</em>) and <em>Charlotte.y</em> (the variable in <em>ca.pm</em>). Try to avoid having variables with the same names in the two files you want to merge.</p>
<p>There are other types of joins, which you can read more about in Chapter 10 of RDS.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="creating-new-variables" class="section level3">
<h3><strong>Creating new variables</strong></h3>
<p><br />
</p>
<p>As we covered in <a href="https://crd150.github.io/lab2.html#Creating_new_variables">Lab 2</a>, we use the function <code>mutate()</code> to create new variables in a data frame. Here, we need to calculate the percentage of residents by race/ethnicity. The race/ethnicity counts end with the letter “E”. Remember, we want variable names that are short and clear.</p>
<pre class="r"><code>cacounty &lt;- cacounty %&gt;%
                    mutate(pwhite = 100*(nhwhiteE/tpoprE), 
                           pblack = 100*(nhblkE/tpoprE), 
                           pasian = 100*(nhasnE/tpoprE), 
                           phisp = 100*(hispE/tpoprE))</code></pre>
<p>We multiply each race/ethnic proportion by 100 to convert the values into percentages.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="selecting-variables" class="section level3">
<h3><strong>Selecting variables</strong></h3>
<p><br />
</p>
<p>As we covered in <a href="https://crd150.github.io/lab2.html#Selecting_variables">Lab 2</a>, we use the function <code>select()</code> to keep or discard variables from a data frame. Let’s keep the ID variable <em>GEOID</em>, the name of the county <em>NAME</em>, total population <em>tpopr</em>, percent college graduates <em>pcol</em>, and all the percent race/ethnicity variables. Save the changes back into <em>caccounty</em>.</p>
<pre class="r"><code>cacounty &lt;- cacounty %&gt;%
              select(GEOID, NAME, tpoprE, pcol, pwhite, pblack, pasian, phisp)</code></pre>
<p>Just to verify we got it right, check <em>cacounty</em>’s column names</p>
<pre class="r"><code>names(cacounty)</code></pre>
<pre><code>## [1] &quot;GEOID&quot;  &quot;NAME&quot;   &quot;tpoprE&quot; &quot;pcol&quot;   &quot;pwhite&quot; &quot;pblack&quot; &quot;pasian&quot; &quot;phisp&quot;</code></pre>
<p>There are many other <em>tidyverse</em> data wrangling functions that we have not covered. To learn about them and for a succinct summary of the functions we have covered in the last two labs, check out RStudio’s Data Wrangling <a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheat sheet</a>.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="missing-data" class="section level3">
<h3><strong>Missing data</strong></h3>
<p><br />
</p>
<p>A special value used across all data types is <code>NA</code>. The value <code>NA</code> indicates a missing value (stands for “Not Available”). Properly treating missing values is very important. The first question to ask when they appear is whether they should be missing in the first place. Or did you make a mistake when data wrangling? If so, fix the mistake, dude. If they should be missing, the second question becomes how to treat them. Can they be ignored? Should the records with NAs be removed? We briefly covered missing data in Handout 2.</p>
<p>Numerics also use other special values to handle problematic values after division. R spits out <code>-Inf</code> and <code>Inf</code> when dividing a negative and positive value by 0, respectively, and <code>NaN</code> when dividing 0 by 0.</p>
<pre class="r"><code>-1/0</code></pre>
<pre><code>## [1] -Inf</code></pre>
<pre class="r"><code>1/0</code></pre>
<pre><code>## [1] Inf</code></pre>
<pre class="r"><code>0/0</code></pre>
<pre><code>## [1] NaN</code></pre>
<p>You will likely encounter <code>NA</code>, <code>Inf</code>, and <code>NaN</code> values, even in already relatively clean datasets like those produced by the Census. The first step you should take is to determine if you have missing values in your dataset. There are two ways of doing this. First, you can run the function <code>aggr()</code>, which is in the <strong>VIM</strong> package. Run the <code>aggr()</code> function as follows</p>
<pre class="r"><code>summary(aggr(ca.pm))</code></pre>
<p><img src="lab3_files/figure-html/unnamed-chunk-20-1.png" /><!-- --></p>
<pre><code>## 
##  Missings per variable: 
##        Variable Count
##          County     0
##       FIPS Code     0
##  Formatted FIPS     0
##            pcol     0
## 
##  Missings in combinations of variables: 
##  Combinations Count Percent
##       0:0:0:0    58     100</code></pre>
<p>The results show two tables and two plots. The left-hand side plot shows the proportion of cases that are missing values for each variable in the data set. The right-hand side plot shows which combinations of variables are missing. The first table shows the number of cases that are missing values for each variable in the data set. The second table shows the percent of cases missing values based on combinations of variables. The results show that we have no missing values. Hooray!</p>
<p>We can also check missingness using the <code>summary()</code> function.</p>
<pre class="r"><code>summary(cacounty)</code></pre>
<pre><code>##     GEOID               NAME               tpoprE              pcol      
##  Length:58          Length:58          Min.   :    1039   Min.   :12.95  
##  Class :character   Class :character   1st Qu.:   47647   1st Qu.:17.29  
##  Mode  :character   Mode  :character   Median :  184632   Median :24.07  
##                                        Mean   :  677302   Mean   :27.29  
##                                        3rd Qu.:  692751   3rd Qu.:35.17  
##                                        Max.   :10081570   Max.   :59.49  
##      pwhite          pblack             pasian           phisp       
##  Min.   :10.64   Min.   : 0.06579   Min.   : 0.000   Min.   : 7.299  
##  1st Qu.:35.31   1st Qu.: 1.03318   1st Qu.: 1.614   1st Qu.:14.680  
##  Median :51.95   Median : 1.82224   Median : 4.236   Median :25.531  
##  Mean   :53.74   Mean   : 2.98417   Mean   : 7.307   Mean   :30.622  
##  3rd Qu.:71.77   3rd Qu.: 3.32593   3rd Qu.: 7.867   3rd Qu.:44.700  
##  Max.   :87.57   Max.   :13.50115   Max.   :36.280   Max.   :84.212</code></pre>
<p>The summary provides the minimum, 25th percentile, median, mean, 75th percentile and maximum for each numeric variable. It will also indicate the number of observations missing values for each variable, which is none in our case.</p>
<p>We were fortunate to have no missing data. However, in many situations, missing data will be present. Check the PolicyMap guide located <a href="https://crd150.github.io/policymap.html">here</a> to see how to deal with missingness in PolicyMap data. We’ll also cover more about what to do with missing data when conducting exploratory data analysis in Lab 4.</p>
<div style="margin-bottom:25px;">

</div>
</div>
</div>
<div id="census-tracts" class="section level2">
<h2><strong>Census tracts</strong></h2>
<p><br />
</p>
<p>So far in this lab we’ve been working with county-level data. That is, the rows or units of observations in our data set represented counties. In most of the labs and assignments moving forward, we will be working with neighborhood data, using census tracts to represent neighborhoods.</p>
<p>Let’s bring in census tract racial/ethnic composition using <code>get_acs()</code>.</p>
<pre class="r"><code>catracts &lt;- get_acs(geography = &quot;tract&quot;, 
              year = 2019,
              variables = c(tpopr = &quot;B03002_001&quot;, 
                            nhwhite = &quot;B03002_003&quot;, nhblk = &quot;B03002_004&quot;, 
                            nhasn = &quot;B03002_006&quot;, hisp = &quot;B03002_012&quot;), 
              state = &quot;CA&quot;,
              survey = &quot;acs5&quot;,
              output = &quot;wide&quot;)</code></pre>
<p>You’ll find that the code is nearly identical to the code we used to bring in the county data, except we replace <code>county</code> with <code>tract</code> for <code>geography =</code>. We’ll work with tract data more in the next lab when we explore methods and techniques in exploratory data analysis.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="assignment-3" class="section level2">
<h2><strong>Assignment 3</strong></h2>
<p><br />
</p>
<p>Download and open the <a href="https://raw.githubusercontent.com/crd150/data/master/yourLastName_firstInitial_asgn03.Rmd">Assignment 3 R Markdown Script</a>. Any response requiring a data analysis task must be supported by code you generate to produce your result. Just examining your various objects in the “Environment” section of R Studio is insufficient—you must use scripted commands. Submit the <code>Rmd</code> and its knitted <code>html</code> files on Canvas. We’ve put together some additional R tips <a href="https://crd150.github.io/tips.html">here</a> in the likely case you get stuck.</p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>California housing is super duper <a href="https://www.bloomberg.com/graphics/2019-california-housing-crisis/">expensive!</a> How many years of income will it take to buy a home in California? Let’s answer this question by examining <a href="https://www.citylab.com/equity/2018/05/where-the-house-price-to-income-ratio-is-most-out-of-whack/561404/">house-price-to-income ratios</a> in California counties. The ratio gives you the number of years a household needs in order to completely pay for housing in California assuming it uses all of its income to pay it off. Run the following data wrangling tasks. Submit all the code you used to accomplish these tasks. Where possible, use the pipe operator <code>%&gt;%</code>.</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Using the Census API, bring into R 2015-19 American Community Survey county-level estimates of <a href="https://www.socialexplorer.com/data/ACS2019_5yr/metadata/?ds=ACS19_5yr&amp;table=B25077">median housing value</a> in California. Make sure the data set is clean - a county should be listed in only one row and the columns should have the county FIPS code, name, and estimates of the median housing value. (2 points)</li>
<li>Using PolicyMap, bring into R 2015-19 American Community Survey estimates of median household income for all counties in California. Clean the data set. (3 points)</li>
<li>Merge the files from (a) and (b) together. Create a variable containing the ratio of median housing value to median household income. That is, the variable should divide the median housing value by the median household income. (2 points)</li>
<li>How many years will it take for a household to pay off a house in Yolo County in 2015-19? (1 point)</li>
<li>Which county has the largest housing value-to-income ratio in 2015-2019? Smallest? (3 points)</li>
</ol>
<p><br></p>
<ol start="2" style="list-style-type: decimal">
<li>California has experienced a number of historically devastating wildfires in recent years. One of the most destructive fires occurred in <a href="https://en.wikipedia.org/wiki/Camp_Fire_(2018)">Butte County in November 2018</a>. Some <a href="https://www.npr.org/2019/11/09/777801169/the-camp-fire-destroyed-11-000-homes-a-year-later-only-11-have-been-rebuilt">news</a> <a href="https://www.citylab.com/equity/2017/11/wildfires-have-worsened-the-bay-areas-housing-crisis/546647/">articles</a> posited that the wild fires will have severe immediate consequences on the local housing market. Because the fires burned down a large proportion of homes, reducing housing stock, housing and rental prices will increase because of the low supply and the high demand. The Census released the 2019 1-year ACS data a few months ago, allowing us to test whether rental and housing values in Butte County increased approximately one year after the fires.</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>Use the Census API to bring in 1-year ACS estimates of <a href="https://www.socialexplorer.com/data/ACS2018/metadata/?ds=ACS18&amp;table=B25077">median housing values</a> and <a href="https://www.socialexplorer.com/data/ACS2018/metadata/?ds=ACS18&amp;table=B25064">median gross rent</a> for California counties in 2018. Do the same for 2019 and merge these files together using their GEOID. Filter to keep just Butte county. (3 points)</p></li>
<li><p>Take the difference between the 2018 and 2019 median housing values. Do the same for median gross rent. Did housing values go up in Butte county? What about rent? (3 points)</p></li>
<li><p>We need an appropriate comparison to Butte county to determine whether the changes we calculated in (b) are large. Repeat (a) and (b) but for the state of California to get the increase in the state’s median housing value and median gross rent from 2018 to 2019. How do the values you calculated in (b) compare to California? (3 points)</p></li>
</ol>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
<p>Website created and maintained by <a href="https://nbrazil.faculty.ucdavis.edu/">Noli Brazil</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
