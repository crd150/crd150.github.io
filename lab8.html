<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 8: Mapping Open Data</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CRD 150: Spring 2022</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="hw_guidelines.html">Assignment Guidelines</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs/Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lab1.html">Lab 1</a>
    </li>
    <li>
      <a href="lab2.html">Lab 2</a>
    </li>
    <li>
      <a href="lab3.html">Lab 3</a>
    </li>
    <li>
      <a href="lab4.html">Lab 4</a>
    </li>
    <li>
      <a href="lab5.html">Lab 5</a>
    </li>
    <li>
      <a href="lab6.html">Lab 6</a>
    </li>
    <li>
      <a href="lab7a.html">Lab 7a</a>
    </li>
    <li>
      <a href="lab7b.html">Lab 7b</a>
    </li>
    <li>
      <a href="lab8.html">Lab 8</a>
    </li>
    <li>
      <a href="lab9.html">Lab 9</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="eligible.html">Eligible Communities</a>
    </li>
    <li>
      <a href="tips.html">R tips</a>
    </li>
    <li>
      <a href="ndata.html">Neighborhood Data Sources</a>
    </li>
    <li>
      <a href="bigopendata.html">Big and Open Data Sources</a>
    </li>
    <li>
      <a href="policymap.html">PolicyMap </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lab 8: Mapping Open Data</h1>
<h3 class="subtitle"><h4 style="font-style:normal">
CRD 150 - Quantitative Methods in Community Research
</h4></h3>
<h4 class="author"><h4 style="font-style:normal">
Professor Noli Brazil
</h4></h4>
<h4 class="date"><h4 style="font-style:normal">
May 18, 2022
</h4></h4>

</div>


<style>
p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 25px;
border-radius: 5px;
font-style: normal;
}

.figure {
   margin-top: 20px;
   margin-bottom: 20px;
}

h1.title {
  font-weight: bold;
  font-family: Arial;  
}

h2.title {
  font-family: Arial;  
}

</style>
<style type="text/css">
#TOC {
  font-size: 13px;
  font-family: Arial;
}
</style>
<p><br />
</p>
<p>In our journey into spatial R, we’ve been exclusively working with polygon data. In this guide you will learn how to handle and descriptively analyze point data. More broadly, we will cover how to access and clean data from Open Data portals. The objectives of the guide are as follows</p>
<ol style="list-style-type: decimal">
<li>Learn how to download data from an Open Data portal</li>
<li>Learn how to read in point data into R</li>
<li>Learn how to put latitude and longitude data on a map</li>
<li>Learn how to put street addresses on a map</li>
<li>Learn how to map point data</li>
</ol>
<p>To achieve these objectives, we will examine the spatial distribution of homeless encampments in the City of Los Angeles using 311 data downloaded from the city’s <a href="https://data.lacity.org/">open data portal</a>.</p>
<p>This lab guide follows closely and supplements the material presented in Chapters 2.4, 2.5, 4.2 and 6 in the textbook <a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a> (GWR).</p>
<p class="comment">
<strong>Assignment 8 is due by 10:00 am, May 27th on Canvas.</strong> See <a href="https://crd150.github.io/hw_guidelines.html">here</a> for assignment guidelines. You must submit an <code>.Rmd</code> file and its associated <code>.html</code> file. Name the files: yourLastName_firstInitial_asgn08. For example: brazil_n_asgn08.
</p>
<div style="margin-bottom:25px;">

</div>
<div id="open-up-an-r-markdown-file" class="section level2">
<h2><strong>Open up an R Markdown file</strong></h2>
<p><br />
</p>
<p>Download the <a href="https://raw.githubusercontent.com/crd150/data/master/labtemplate.Rmd">Lab template</a> into an appropriate folder on your hard drive (preferably, a folder named ‘Lab 8’), open it in R Studio, and type and run your code there. The template is also located on Canvas under Files. Change the title (“Lab 8”) and insert your name and date. Don’t change anything else inside the YAML (the stuff at the top in between the <code>---</code>). For a rundown on the use of R Markdown, see the <a href="https://crd150.github.io/hw_guidelines.html">assignment guidelines</a>.</p>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="installing-and-loading-packages" class="section level2">
<h2><strong>Installing and loading packages</strong></h2>
<p><br />
</p>
<p>You’ll need to install the following package in R. We’ll talk about what this package provides as its relevant functions come up in the guide.</p>
<pre class="r"><code>install.packages(&quot;tidygeocoder&quot;)</code></pre>
<p>You’ll need to load the following packages. Unlike installing, you will always need to load packages whenever you start a new R session. You’ll also always need to use <code>library()</code> in your R Markdown file.</p>
<pre class="r"><code>library(sf)
library(tidyverse)
library(tidycensus)
library(tigris)
library(tmap)
library(rmapshaper)
library(tidygeocoder)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="read-in-census-tract-data" class="section level2">
<h2><strong>Read in census tract data</strong></h2>
<p><br />
</p>
<p>We will need to bring in census tract polygon features and racial composition data from the 2015-2019 American Community Survey using the Census API and keep tracts within Los Angeles city boundaries using a clip. The code for accomplishing these tasks is below. We won’t go through each line of code in detail because we’ve covered all of these operations and functions in prior labs. I’ve embedded comments within the code that briefly explain what each chunk is doing, but go back to prior guides (or RDS/GWR) if you need further help.</p>
<pre class="r"><code># Bring in census tract data. 
ca.tracts &lt;- get_acs(geography = &quot;tract&quot;, 
              year = 2019,
              variables = c(tpop = &quot;B01003_001&quot;, tpopr = &quot;B03002_001&quot;, 
                            nhwhite = &quot;B03002_003&quot;, nhblk = &quot;B03002_004&quot;,
                             nhasn = &quot;B03002_006&quot;, hisp = &quot;B03002_012&quot;),
              state = &quot;CA&quot;,
              survey = &quot;acs5&quot;,
              output = &quot;wide&quot;,
              geometry = TRUE)

# Make the data tidy, calculate percent race/ethnicity, and keep essential vars.
ca.tracts &lt;- ca.tracts %&gt;% 
  rename_with(~ sub(&quot;E$&quot;, &quot;&quot;, .x), everything()) %&gt;%
  mutate(pnhwhite = nhwhite/tpopr, pnhasn = nhasn/tpopr, 
              pnhblk = nhblk/tpopr, phisp = hisp/tpopr) %&gt;%
  select(c(GEOID,tpop, pnhwhite, pnhasn, pnhblk, phisp))  

# Bring in city boundary data
pl &lt;- places(state = &quot;CA&quot;, cb = TRUE)

# Keep LA city
la.city &lt;- filter(pl, NAME == &quot;Los Angeles&quot;)

#Clip tracts using LA boundary
la.city.tracts &lt;- ms_clip(target = ca.tracts, clip = la.city, remove_slivers = TRUE)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="point-data-from-an-open-data-portal" class="section level2">
<h2><strong>Point data from an open data portal</strong></h2>
<p><br />
</p>
<p>We will be examining the spatial distribution of homeless encampments in Los Angeles City. We will download homeless encampment data from Los Angeles’ Open Data portal. The data represent homeless encampment locations in 2019 as reported through the City’s <a href="https://www.lacity.org/myla311">311 system</a>. To download the data from LA’s open data portal, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Navigate to the <a href="https://data.lacity.org/A-Well-Run-City/MyLA311-Service-Request-Data-2019/pvft-t768">Los Angeles City Open Data portal</a></li>
<li>Click on <em>View Data</em>. This will bring up the data in an excel style worksheet.</li>
<li>You’ll find that there are over one million 311 requests in 2019. Rather than bring all of these requests into R, let’s just filter for homeless encampments. To do this, click on <em>Filter</em>, <em>Add a New Filter Condition</em>, select <em>Request Type</em> from the first pull down menu, then type in <em>Homeless Encampment</em> in the first text box. Hit return/enter.</li>
<li>Click on <em>Export</em> and select <em>CSV</em>. Download the file into an appropriate folder on your hard drive. Name the file “homeless311_la_2019”.</li>
</ol>
<p>Read the file into R using the function <code>read_csv()</code>. Make sure your current working directory is pointing to the appropriate folder (use <code>getwd()</code> to see the current directory and <code>setwd()</code> to change it).</p>
<pre class="r"><code>homeless311.df &lt;- read_csv(&quot;homeless311_la_2019.csv&quot;)</code></pre>
<p>If you had trouble downloading the file, I uploaded it onto GitHub. Read the file into R using the following code.</p>
<pre class="r"><code>homeless311.df &lt;- read_csv(&quot;https://raw.githubusercontent.com/crd150/data/master/homeless311_la_2019.csv&quot;)</code></pre>
<p>Whenever you bring a dataset into R, always look at it. For example, we examine <em>homeless311.df</em> using <code>glimpse()</code></p>
<pre class="r"><code>glimpse(homeless311.df)</code></pre>
<pre><code>## Rows: 55,536
## Columns: 34
## $ SRNumber                  &lt;chr&gt; &quot;1-1523590871&quot;, &quot;1-1523576655&quot;, &quot;1-152357498…
## $ CreatedDate               &lt;chr&gt; &quot;12/31/2019 11:26:00 PM&quot;, &quot;12/31/2019 09:27:…
## $ UpdatedDate               &lt;chr&gt; &quot;01/14/2020 07:52:00 AM&quot;, &quot;01/08/2020 01:42:…
## $ ActionTaken               &lt;chr&gt; &quot;SR Created&quot;, &quot;SR Created&quot;, &quot;SR Created&quot;, &quot;S…
## $ Owner                     &lt;chr&gt; &quot;BOS&quot;, &quot;BOS&quot;, &quot;BOS&quot;, &quot;BOS&quot;, &quot;BOS&quot;, &quot;LASAN&quot;, …
## $ RequestType               &lt;chr&gt; &quot;Homeless Encampment&quot;, &quot;Homeless Encampment&quot;…
## $ Status                    &lt;chr&gt; &quot;Closed&quot;, &quot;Closed&quot;, &quot;Closed&quot;, &quot;Closed&quot;, &quot;Clo…
## $ RequestSource             &lt;chr&gt; &quot;Mobile App&quot;, &quot;Mobile App&quot;, &quot;Mobile App&quot;, &quot;M…
## $ CreatedByUserOrganization &lt;chr&gt; &quot;Self Service&quot;, &quot;Self Service&quot;, &quot;Self Servic…
## $ MobileOS                  &lt;chr&gt; &quot;iOS&quot;, &quot;Android&quot;, &quot;iOS&quot;, &quot;iOS&quot;, &quot;iOS&quot;, NA, &quot;…
## $ Anonymous                 &lt;chr&gt; &quot;N&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;,…
## $ AssignTo                  &lt;chr&gt; &quot;WV&quot;, &quot;WV&quot;, &quot;WV&quot;, &quot;WV&quot;, &quot;WV&quot;, &quot;NC&quot;, &quot;WV&quot;, &quot;W…
## $ ServiceDate               &lt;chr&gt; &quot;01/14/2020 12:00:00 AM&quot;, &quot;01/10/2020 12:00:…
## $ ClosedDate                &lt;chr&gt; &quot;01/14/2020 07:51:00 AM&quot;, &quot;01/08/2020 01:42:…
## $ AddressVerified           &lt;chr&gt; &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;, &quot;Y&quot;,…
## $ ApproximateAddress        &lt;chr&gt; NA, NA, NA, NA, NA, &quot;N&quot;, NA, NA, NA, NA, &quot;N&quot;…
## $ Address                   &lt;chr&gt; &quot;CANOGA AVE AT VANOWEN ST, 91303&quot;, &quot;23001 W …
## $ HouseNumber               &lt;dbl&gt; NA, 23001, NA, 5550, 5550, NA, 5200, 5500, 2…
## $ Direction                 &lt;chr&gt; NA, &quot;W&quot;, NA, &quot;N&quot;, &quot;N&quot;, NA, &quot;N&quot;, &quot;N&quot;, &quot;S&quot;, &quot;W…
## $ StreetName                &lt;chr&gt; NA, &quot;VANOWEN&quot;, NA, &quot;WINNETKA&quot;, &quot;WINNETKA&quot;, N…
## $ Suffix                    &lt;chr&gt; NA, &quot;ST&quot;, NA, &quot;AVE&quot;, &quot;AVE&quot;, NA, &quot;AVE&quot;, &quot;AVE&quot;…
## $ ZipCode                   &lt;dbl&gt; 91303, 91307, 91367, 91364, 91364, 90004, 91…
## $ Latitude                  &lt;dbl&gt; 34.19375, 34.19388, 34.17220, 34.17143, 34.1…
## $ Longitude                 &lt;dbl&gt; -118.5975, -118.6281, -118.5710, -118.5707, …
## $ Location                  &lt;chr&gt; &quot;(34.1937512753, -118.597510305)&quot;, &quot;(34.1938…
## $ TBMPage                   &lt;dbl&gt; 530, 529, 560, 560, 560, 594, 559, 559, 634,…
## $ TBMColumn                 &lt;chr&gt; &quot;B&quot;, &quot;G&quot;, &quot;E&quot;, &quot;E&quot;, &quot;E&quot;, &quot;A&quot;, &quot;H&quot;, &quot;J&quot;, &quot;B&quot;,…
## $ TBMRow                    &lt;dbl&gt; 6, 6, 2, 2, 2, 7, 3, 2, 6, 3, 3, 2, 7, 3, 2,…
## $ APC                       &lt;chr&gt; &quot;South Valley APC&quot;, &quot;South Valley APC&quot;, &quot;Sou…
## $ CD                        &lt;dbl&gt; 3, 12, 3, 3, 3, 13, 3, 3, 1, 3, 7, 3, 3, 4, …
## $ CDMember                  &lt;chr&gt; &quot;Bob Blumenfield&quot;, &quot;John Lee&quot;, &quot;Bob Blumenfi…
## $ NC                        &lt;dbl&gt; 13, 11, 16, 16, 16, 55, 16, 16, 76, 16, 101,…
## $ NCName                    &lt;chr&gt; &quot;CANOGA PARK NC&quot;, &quot;WEST HILLS NC&quot;, &quot;WOODLAND…
## $ PolicePrecinct            &lt;chr&gt; &quot;TOPANGA&quot;, &quot;TOPANGA&quot;, &quot;TOPANGA&quot;, &quot;TOPANGA&quot;, …</code></pre>
<p>Let’s bring in a csv file containing the street addresses of <a href="https://data-lahub.opendata.arcgis.com/datasets/b0f7b2ebce0146069c74abf4b25a6688_158">homeless shelters and services in Los Angeles County</a> (as of 2019), which I also downloaded from Los Angeles’ open data portal. I uploaded the file onto Github so you don’t have to download it from the portal like we did above with encampments (however, download the file on your own time using the link above to get more practice working with open data portals).</p>
<pre class="r"><code>shelters.df &lt;- read_csv(&quot;https://raw.githubusercontent.com/crd150/data/master/Homeless_Shelters_and_Services.csv&quot;)</code></pre>
<p>Take a look at the data</p>
<pre class="r"><code>glimpse(shelters.df)</code></pre>
<pre><code>## Rows: 182
## Columns: 23
## $ source       &lt;chr&gt; &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;211&quot;, &quot;…
## $ ext_id       &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ cat1         &lt;chr&gt; &quot;Social Services&quot;, &quot;Social Services&quot;, &quot;Social Services&quot;, …
## $ cat2         &lt;chr&gt; &quot;Homeless Shelters and Services&quot;, &quot;Homeless Shelters and …
## $ cat3         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ org_name     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, &quot;www.catalystfdn.org&quot;…
## $ Name         &lt;chr&gt; &quot;Special Service For Groups -  Project 180&quot;, &quot;1736 Family…
## $ addrln1      &lt;chr&gt; &quot;420 S. San Pedro&quot;, &quot;2116 Arlington Ave&quot;, &quot;1736 Monterey …
## $ addrln2      &lt;chr&gt; NA, &quot;Suite 200&quot;, NA, NA, NA, NA, &quot;4th Fl.&quot;, NA, NA, NA, N…
## $ city         &lt;chr&gt; &quot;Los Angeles&quot;, &quot;Los Angeles&quot;, &quot;Hermosa Beach&quot;, &quot;Monrovia&quot;…
## $ state        &lt;chr&gt; &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA&quot;, &quot;CA…
## $ hours        &lt;chr&gt; &quot;SITE HOURS:  Monday through Friday, 8:30am to 4:30pm.&quot;, …
## $ email        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ url          &lt;chr&gt; &quot;ssgmain.org/&quot;, &quot;www.1736fcc.org&quot;, &quot;www.1736fcc.org&quot;, &quot;ww…
## $ info1        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ info2        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ post_id      &lt;dbl&gt; 772, 786, 788, 794, 795, 946, 947, 1073, 1133, 1283, 1353…
## $ description  &lt;chr&gt; &quot;The agency provides advocacy, child care, HIV/AIDS servi…
## $ zip          &lt;dbl&gt; 90013, 90018, 90254, 91016, 91776, 90028, 90027, 90019, 9…
## $ link         &lt;chr&gt; &quot;http://egis3.lacounty.gov/lms/?p=772&quot;, &quot;http://egis3.lac…
## $ use_type     &lt;chr&gt; &quot;publish&quot;, &quot;publish&quot;, &quot;publish&quot;, &quot;publish&quot;, &quot;publish&quot;, &quot;p…
## $ date_updated &lt;chr&gt; &quot;2017/10/30 14:43:13+00&quot;, &quot;2017/10/06 16:28:29+00&quot;, &quot;2017…
## $ dis_status   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="putting-points-on-a-map" class="section level2">
<h2><strong>Putting points on a map</strong></h2>
<p><br />
</p>
<p>Notice that the data we brought in are not spatial. They are regular tibbles, not <strong>sf</strong> objects.</p>
<pre class="r"><code>class(homeless311.df)</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<pre class="r"><code>class(shelters.df)</code></pre>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<p>In order to convert these nonspatial objects into spatial objects, we need to geolocate them. To do this, use the geographic coordinates (longitude and latitude) to place points on a map. The file <em>homeless311.df</em> has longitude and latitude coordinates, so we have all the information we need to convert it to a spatial object.</p>
<p>We will use the function <code>st_as_sf()</code> to create a point <strong>sf</strong> object out of <em>homeless311.df</em> using the geographic coordinates. Geographic coordinates are in the form of a longitude and latitude, where longitude is your X coordinate and spans East/West and latitude is your Y coordinate and spans North/South. The function <code>st_as_sf()</code> requires you to specify the longitude and latitude of each point using the <code>coords =</code> argument, which are conveniently stored in the variables <em>Longitude</em> and <em>Latitude</em> in <em>homeless311.df</em>. We need to take out any observations with missing values <code>NA</code> for either <em>Longitude</em> or <em>Latitude</em>. Do this by using the function <code>is.na()</code> within the <code>filter()</code> function.</p>
<pre class="r"><code>homeless311.df &lt;- homeless311.df %&gt;%
                filter(is.na(Longitude) == FALSE &amp; is.na(Latitude) == FALSE)</code></pre>
<p>You also need to establish the Coordinate Reference System (CRS) using the <code>crs =</code> argument, which I covered in Tuesday’s lecture. To establish a CRS, you will need to specify the Geographic Coordinate System (so you know where your points are on Earth), which encompasses the datum and ellipse, and a Projection (a way of putting points in 2 dimensions or on a flat map).</p>
<pre class="r"><code>homeless311.sf &lt;- st_as_sf(homeless311.df, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;), crs = &quot;+proj=longlat +datum=NAD83 +ellps=WGS84&quot;)</code></pre>
<p>For <code>crs =</code>, we establish the projection <code>+proj=</code>, datum <code>+datum=</code> and ellipse <code>+ellps</code>. Because we have latitude and longitude, <code>+proj=</code> is established as <code>longlat</code>. We use NAD83 for datum and WGS84 ellipse. The most common datum and ellipsoid combinations are listed in Figure 1 in the Coordinate_Reference_Systems.pdf document on Canvas (Files - Other Resources). For the purposes of this lab and assignment 8 (and in your final project if you choose to use point data), use the crs specified above.</p>
<p>Note that the CRS should have only have one space in between <code>+proj=longlat</code>, <code>+datum=WGS84</code> and <code>+ellps=WGS84</code>. And you should have no spaces anywhere else. Be careful about this because if you introduce spaces elsewhere you will get an incorrect CRS (and R will not give you an error to let you know). Also note that the longitude will always go before the latitude in <code>coords =</code>.</p>
<p>Now we can map encampments over Los Angeles City tracts using our new best friend <code>tm_shape()</code>, whom we met in <a href="https://crd150.github.io/lab5.html#Mapping_in_R">Lab 5</a>.</p>
<pre class="r"><code>tm_shape(la.city.tracts) +  
  tm_polygons() +
tm_shape(homeless311.sf) +  
  tm_dots(col=&quot;red&quot;)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="street-addresses" class="section level2">
<h2><strong>Street Addresses</strong></h2>
<p><br />
</p>
<p>Often you will get point data that won’t have longitude/X and latitude/Y coordinates but instead have street addresses. The process of going from address to X/Y coordinates is known as geocoding.</p>
<p>To demonstrate geocoding, type in your street address, city and state inside the quotes below. We are saving our address in an object we named <em>myaddress.df</em>.</p>
<pre class="r"><code>myaddress.df  &lt;- tibble(street = &quot;&quot;, city = &quot;&quot;, state = &quot;&quot;)</code></pre>
<p>This creates a tibble with your street, city and state saved in three variables. To geocode addresses to longitude and latitude, use the function <code>geocode()</code> which is a part of the <strong>tidygeocoder</strong> package. Use <code>geocode()</code> as follows</p>
<pre class="r"><code>myaddress.df &lt;- geocode(myaddress.df, street = street, city = city, state = state, method = &quot;census&quot;)</code></pre>
<p>Here, we specify street, city and state variables, which are conveniently named <em>street</em>, <em>city</em>, and <em>state</em> in <em>myaddress.df</em>. The argument <code>method = 'census'</code> specifies the geocoder used to map addresses to longitude/latitude locations. In the above case <code>'census'</code> uses the geocoder provided by the U.S. Census to find the address. Think of a geocoder as R going to the Census geocoder <a href="https://geocoding.geo.census.gov/">website</a>, searching for each address, plucking the latitude and longitude of the address, and saving it into a tibble named <em>myaddress.df</em>. Other geocoders include Google and <a href="https://www.openstreetmap.org/#map=4/38.01/-95.84">OpenStreetMap</a>.</p>
<p>If you view this object, you’ll find the latitude <em>lat</em> and longitude <em>long</em> attached as columns. Convert this point to an <strong>sf</strong> object using the function <code>st_as_sf()</code> like we did above with the encampments.</p>
<pre class="r"><code>myaddress.sf &lt;- st_as_sf(myaddress.df, coords = c(&quot;long&quot;, &quot;lat&quot;))</code></pre>
<p>Type in <code>tmap_mode("view")</code> and then <a href="https://crd150.github.io/lab5.html#Interactive_maps">map</a> <em>myaddress.sf</em>. Zoom into the point. Did it get your home address correct?</p>
<p><br></p>
<p>The file <em>shelters.df</em> contains no latitude and longitude data, so we need to convert the street addresses contained in the variables <em>addrln1</em>, <em>city</em> and <em>state</em>. Use the function <code>geocode()</code> like we did above. We use <code>method = 'census'</code> to indicate we want to use the Census API to geocode the addresses for us (as opposed to other geocoders that are available). The process may take a few minutes so be patient (listen to one of my <a href="https://www.youtube.com/watch?v=ImKY6TZEyrI">favorite songs</a> while you are waiting).</p>
<pre class="r"><code>shelters.geo &lt;- geocode(shelters.df, street = addrln1, city = city, state = state, method = &#39;census&#39;)</code></pre>
<p>Look at the column names.</p>
<pre class="r"><code>names(shelters.geo)</code></pre>
<pre><code>##  [1] &quot;source&quot;       &quot;ext_id&quot;       &quot;cat1&quot;         &quot;cat2&quot;         &quot;cat3&quot;        
##  [6] &quot;org_name&quot;     &quot;Name&quot;         &quot;addrln1&quot;      &quot;addrln2&quot;      &quot;city&quot;        
## [11] &quot;state&quot;        &quot;hours&quot;        &quot;email&quot;        &quot;url&quot;          &quot;info1&quot;       
## [16] &quot;info2&quot;        &quot;post_id&quot;      &quot;description&quot;  &quot;zip&quot;          &quot;link&quot;        
## [21] &quot;use_type&quot;     &quot;date_updated&quot; &quot;dis_status&quot;   &quot;lat&quot;          &quot;long&quot;</code></pre>
<p>We see the latitudes and longitudes are attached to the variables <em>lat</em> and <em>long</em>, respectively. Notice that not all the addresses were successfully geocoded.</p>
<pre class="r"><code>summary(shelters.geo$lat)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   33.74   33.99   34.05   34.08   34.12   34.70      15</code></pre>
<p>30 shelters received an <code>NA</code>. This is likely because the addresses are not correct, has errors, or are not fully specified. You’ll have to manually fix these issues, which becomes time consuming if you have a really large data set. For the purposes of this lab, let’s just discard these, but in practice, make sure to double check your address data (See the document Geocoding_Best_Practices.pdf in the Other Resources folder on Canvas for best practices for cleaning address data). We use the <code>filter()</code> function to filter out the NAs.</p>
<pre class="r"><code>shelters.geo &lt;- shelters.geo %&gt;%
                filter(is.na(lat) == FALSE &amp; is.na(long) == FALSE)</code></pre>
<p>Convert latitude and longitude data into spatial points using the function <code>st_as_sf()</code> like we did above for homeless encampments.</p>
<pre class="r"><code>shelters.sf &lt;- st_as_sf(shelters.geo, coords = c(&quot;long&quot;, &quot;lat&quot;), crs = &quot;+proj=longlat +datum=NAD83 +ellps=WGS84&quot;)</code></pre>
<p>Now, let’s map shelters and encampments on top of tracts.</p>
<pre class="r"><code>tm_shape(la.city.tracts) +
  tm_polygons() +
tm_shape(homeless311.sf) +  
  tm_dots(col=&quot;red&quot;) +
tm_shape(shelters.sf) +  
  tm_dots(col=&quot;blue&quot;)</code></pre>
<div style="margin-bottom:25px;">

</div>
</div>
<div id="mapping-point-patterns" class="section level2">
<h2><strong>Mapping point patterns</strong></h2>
<p><br />
</p>
<p>Other than mapping their locations (e.g. pin or dot map), how else can we visually present point locations? When working with neighborhoods, we can examine point distributions by summing up the number of points in each neighborhood.</p>
<p>To do this, we can use the function <code>aggregate()</code>.</p>
<pre class="r"><code>hcamps_agg &lt;- aggregate(homeless311.sf[&quot;SRNumber&quot;], la.city.tracts, FUN = &quot;length&quot;)</code></pre>
<p>The first argument is the <strong>sf</strong> points you want to count, in our case <em>homeless311.sf</em>. You then include in bracket and quotes the unique ID for each point, in our case “SRNumber”. The next argument is the object you want to sum the points for, in our case Los Angeles census tracts <em>la.city.tracts</em>. Finally,<code>FUN = "length"</code> tells R to sum up the number of points in each tract.</p>
<p>Take a look at the object we created.</p>
<pre class="r"><code>glimpse(hcamps_agg)</code></pre>
<pre><code>## Rows: 1,001
## Columns: 2
## $ SRNumber &lt;int&gt; 110, 32, 35, 186, 7, 3, 6, 32, 2, 37, 1, 18, 31, 11, 28, 173,…
## $ geometry &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-118.2156 3..., MULTIPOLYGON (((…</code></pre>
<p>The variable <em>SRNumber</em> gives us the number of points in each of Los Angeles’ tracts. Notice that there are missing values.</p>
<pre class="r"><code>summary(hcamps_agg)</code></pre>
<pre><code>##     SRNumber               geometry   
##  Min.   :  1.00   MULTIPOLYGON :1001  
##  1st Qu.: 10.00   epsg:4269    :   0  
##  Median : 29.00   +proj=long...:   0  
##  Mean   : 56.84                       
##  3rd Qu.: 69.00                       
##  Max.   :822.00                       
##  NA&#39;s   :28</code></pre>
<p>This is because there are tracts that have no homeless encampments. Convert these NA values to 0 using the <code>replace_na()</code> function within the <code>mutate()</code> function.</p>
<pre class="r"><code>hcamps_agg &lt;- hcamps_agg %&gt;%
  mutate(SRNumber = replace_na(SRNumber,0))</code></pre>
<p>The function <code>replace_na()</code> tells R to replace any NAs found in the variable <em>SRNumber</em> with the number 0.</p>
<p>Next, we save the variable <em>SRNumber</em> from <em>hcamps_agg</em> into our main dataset <em>la.city.tracts</em> by creating a new variable <em>hcamps</em> within <code>mutate()</code>.</p>
<pre class="r"><code>la.city.tracts &lt;- la.city.tracts %&gt;%
            mutate(hcamps = hcamps_agg$SRNumber)</code></pre>
<p>We can map the count of break ins by census tract, but counts do not take into consideration exposure. In this case, tracts that are larger in size or greater in population may have more encampments (a concept we covered in Handout 5). Instead, let’s calculate the number of homeless encampments per 1,000 residents.</p>
<pre class="r"><code>la.city.tracts &lt;- la.city.tracts %&gt;%
            mutate(hcamppop = (hcamps/tpop)*1000)</code></pre>
<p>The above code creates the variable <em>hcamppop</em> in <em>la.city.tracts</em>, which represents the number of homeless encampments per 1,000 residents. Note that there are tracts with 0 population sizes, so a division of 0 when you created the variable <em>hcamppop</em> will yield an Inf value, which we covered in <a href="https://crd150.github.io/lab1.html#Numeric">Lab 1</a>. Let’s convert <em>hcamppop</em> to NA for tracts with population sizes of 0 using the <code>replace()</code> function.</p>
<pre class="r"><code>la.city.tracts &lt;- la.city.tracts %&gt;%
            mutate(hcamppop = replace(hcamppop, tpop == 0, NA))</code></pre>
<p>Now we can create a presentable choropleth map of homeless encampments per 1,000 residents for neighborhoods in the City of Los Angeles.</p>
<pre class="r"><code>la.city.tracts %&gt;%
  tm_shape(unit = &quot;mi&quot;) +
    tm_polygons(col = &quot;hcamppop&quot;, style = &quot;quantile&quot;,palette = &quot;Reds&quot;, 
              border.alpha = 0, title = &quot;Encampments per 1k pop&quot;) +
    tm_scale_bar(position = c(&quot;left&quot;, &quot;bottom&quot;)) +
    tm_layout(main.title = &quot;Homeless encampments in Los Angeles Tracts, 2019&quot;,
            main.title.size = 0.95, frame = FALSE,
            legend.outside = TRUE, legend.outside.position = &quot;right&quot;)</code></pre>
<p><img src="lab8_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.</p>
<p>Website created and maintained by <a href="https://nbrazil.faculty.ucdavis.edu/">Noli Brazil</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
